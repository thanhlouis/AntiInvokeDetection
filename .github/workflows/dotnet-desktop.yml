name: Build AntiInvokeDetection .NET Framework

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-2022 
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      # BƯỚC MỚI VÀ QUAN TRỌNG: Cài đặt Targeting Pack cho .NET Framework 4.5
      - name: Install .NET Framework 4.5 Targeting Pack
        uses: sayed/setup-dot-net-framework-targeting-packs@v1
        with:
          # Chỉ định phiên bản .NET Framework cần cài đặt Targeting Pack
          framework-versions: '4.5' 

      # --- CẤU HÌNH CÔNG CỤ ---
      
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1 
        
      - name: Setup NuGet CLI
        uses: nuget/setup-nuget@v1
        
      # --- BUILD VÀ ĐÓNG GÓI ---
      
      - name: Restore NuGet Packages
        run: nuget restore "Anti Invoke Detection.sln"

      - name: Build Solution (Release)
        run: msbuild "Anti Invoke Detection.sln" /p:Configuration=Release

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: AntiInvokeDetection-exe
          path: Anti Invoke Detection/bin/Release/Anti Invoke Detection.exe
