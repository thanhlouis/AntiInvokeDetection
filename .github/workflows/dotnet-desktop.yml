name: Build .NET Framework (Standard)

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-2022 # Sử dụng image runner được hỗ trợ
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # BƯỚC 1: TỰ ĐỘNG CẤU HÌNH MSBUILD VÀO PATH
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1 # Action này dùng vswhere để tìm và cấu hình
        with:
          # (Tùy chọn) Chỉ định kiến trúc nếu bạn không muốn x86 mặc định
          # msbuild-architecture: x64 

      # BƯỚC 2: CÀI ĐẶT CÔNG CỤ NUGET CLI
      - name: Setup NuGet CLI
        uses: nuget/setup-nuget@v1

      # BƯỚC 3: KHÔI PHỤC GÓI (QUAN TRỌNG VỚI packages.config)
      - name: Restore NuGet Packages
        # Luôn restore trên file .sln (solution) để đảm bảo tất cả project được xử lý
        run: nuget restore "Anti Invoke Detection.sln"

      # BƯỚC 4: CHẠY MSBUILD
      - name: Build Solution
        # Khi dùng 'microsoft/setup-msbuild', bạn chỉ cần gọi 'msbuild'
        # vì nó đã được thêm vào biến môi trường PATH
        run: msbuild "Anti Invoke Detection.sln" /p:Configuration=Release

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: exe-output
          path: Anti Invoke Detection/bin/Release/Anti Invoke Detection.exe
